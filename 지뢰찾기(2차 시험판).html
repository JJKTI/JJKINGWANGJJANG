<!DOCTYPE html>
<html>
<head>
  <title>ì§€ë¢°ì°¾ê¸° ê²Œìž„</title>
  <style>
    .board {
      display: inline-block;
      border-collapse: collapse;
    }
    .cell {
      width: 30px;
      height: 30px;
      text-align: center;
      border: 1px solid #ccc;
      cursor: pointer;
      font-weight: bold;
      background-color: #ddd; /* íšŒìƒ‰ ë°°ê²½ */
    }
    #scoreBoard {
      margin-top: 10px;
      font-size: 24px;
    }
  </style>
</head>
<body>

<h2>ì§€ë¢°ì°¾ê¸° ê²Œìž„</h2>

<table class="board" id="board"></table>
<div id="scoreBoard">Score: 0</div>

<script>
  const boardSize = 8; // ë³´ë“œ í¬ê¸°
  const numMines = 10; // ì§€ë¢° ê°œìˆ˜
  let score = 0; // ì ìˆ˜

  let board = [];

  // ë³´ë“œ ì´ˆê¸°í™”
  function initBoard() {
    board = Array.from({ length: boardSize }, () => Array(boardSize).fill(0));

    // ì§€ë¢° ë°°ì¹˜
    let placedMines = 0;
    while (placedMines < numMines) {
      const x = Math.floor(Math.random() * boardSize);
      const y = Math.floor(Math.random() * boardSize);
      if (board[x][y] !== 'M') {
        board[x][y] = 'M';
        placedMines++;
      }
    }

    // ë³´ë“œ ê·¸ë¦¬ê¸°
    const boardElement = document.getElementById('board');
    for (let i = 0; i < boardSize; i++) {
      const row = document.createElement('tr');
      for (let j = 0; j < boardSize; j++) {
        const cell = document.createElement('td');
        cell.classList.add('cell');
        cell.dataset.row = i;
        cell.dataset.col = j;
        cell.textContent = '';
        cell.addEventListener('click', handleCellClick);
        row.appendChild(cell);
      }
      boardElement.appendChild(row);
    }
  }

  function handleCellClick(event) {
  const row = parseInt(event.target.dataset.row);
  const col = parseInt(event.target.dataset.col);

  if (board[row][col] === 'M') {
    // í­íƒ„ì´ ìžˆëŠ” ëª¨ë“  ê³³ì„ ë³´ì—¬ì£¼ê¸°
    const cells = document.querySelectorAll('.cell');
    cells.forEach(cell => {
      const cellRow = parseInt(cell.dataset.row);
      const cellCol = parseInt(cell.dataset.col);
      if (board[cellRow][cellCol] === 'M') {
        cell.style.backgroundColor = 'red';
        cell.innerHTML = '<span style="font-size: 20px;">ðŸ’£</span>';
      }
    });

    // 2ì´ˆ í›„ì— confirm ì°½ í‘œì‹œ
    setTimeout(() => {
      const playAgain = confirm('ê²Œìž„ ì˜¤ë²„! ë‹¤ì‹œ í”Œë ˆì´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (playAgain) {
        resetBoard(); // ë³´ë“œ ì´ˆê¸°í™”
      } else {
        closeGame(); // ê²Œìž„ ì¢…ë£Œ
      }
    }, 2000);
  } else {
      event.target.style.backgroundColor = '#fff'; // íšŒìƒ‰ ì¹¸ ì œê±°

      // ì ìˆ˜ ì¦ê°€ ë° í‘œì‹œ
      score += 100;
      document.getElementById('scoreBoard').textContent = `Score: ${score}`;

      const minesCount = countAdjacentMines(row, col); // ì£¼ë³€ ì§€ë¢° ê°œìˆ˜ ê³„ì‚°
      if (minesCount > 0) {
        event.target.textContent = minesCount; // ì£¼ë³€ ì§€ë¢° ê°œìˆ˜ í‘œì‹œ
      } else {
        // ì£¼ë³€ì— ì§€ë¢°ê°€ ì—†ëŠ” ê²½ìš° ì¶”ê°€ ìž‘ì—… ìˆ˜í–‰
        removeEmptyCells(row, col);
      }
    }
  }

  // ì¸ì ‘í•œ ì…€ ì¤‘ ì§€ë¢°ì˜ ê°œìˆ˜ë¥¼ ì„¸ëŠ” í•¨ìˆ˜
  function countAdjacentMines(row, col) {
    let count = 0;
    const directions = [
      [-1, -1], [-1, 0], [-1, 1],
      [0, -1], [0, 1],
      [1, -1], [1, 0], [1, 1]
    ];

    for (const [dx, dy] of directions) {
      const newRow = row + dx;
      const newCol = col + dy;

      if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
        if (board[newRow][newCol] === 'M') {
          count++;
        }
      }
    }

    return count;
  }

  // ì£¼ë³€ì— ì§€ë¢°ê°€ ì—†ëŠ” ê²½ìš° ì£¼ë³€ì˜ íšŒìƒ‰ ì¹¸ë“¤ì„ ë²—ê²¨ë‚´ëŠ” í•¨ìˆ˜
  function removeEmptyCells(row, col) {
    const directions = [
      [-1, -1], [-1, 0], [-1, 1],
      [0, -1], [0, 1],
      [1, -1], [1, 0], [1, 1]
    ];

    for (const [dx, dy] of directions) {
        const newRow = row + dx;
      const newCol = col + dy;

      if (newRow >= 0 && newRow < boardSize && newCol >= 0 && newCol < boardSize) {
        const cell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
        if (cell && cell.style.backgroundColor === 'rgb(221, 221, 221)') {
          cell.click();
        }
      }
    }
  }

  // ë³´ë“œ ìž¬ì„¤ì • (ê²Œìž„ ë‹¤ì‹œ ì‹œìž‘)
  function resetBoard() {
    const boardElement = document.getElementById('board');
    boardElement.innerHTML = ''; // ë³´ë“œ ì´ˆê¸°í™”

    // ì ìˆ˜ ì´ˆê¸°í™”
    score = 0;
    document.getElementById('scoreBoard').textContent = `Score: ${score}`;

    initBoard(); // ë³´ë“œ ìž¬ì„¤ì •
  }

  // ê²Œìž„ ì¢…ë£Œ
  function closeGame() {
    window.close(); // ì°½ ë‹«ê¸°
  }

  // ê²Œìž„ ì‹œìž‘
  initBoard();
</script>

</body>
</html>
